<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Gus Hahn-Powell">
  <link rel="canonical" href="https://clu-ling.github.io/clu-phontools/examples/asu-use-case/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Aligning and error analysis - clu-phontools</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../../css/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Aligning and error analysis";
    var mkdocs_page_input_path = "examples/asu-use-case.md";
    var mkdocs_page_url = "/clu-phontools/examples/asu-use-case/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> clu-phontools</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">User Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../tutorial/">Usage</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../install/">Installation</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developing</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/install/">Install</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/test/">Testing</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/documentation/">Documentation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dev/formatting/">Formatting</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Examples</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../misc/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rest-api/">REST API</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Aligning and error analysis</a>
    <ul class="current">
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../api/clu/phontools/">clu.phontools</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">About</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../contributing/">Contributing</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://opensource.org/licenses/Apache-2.0">License</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">clu-phontools</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Examples &raquo;</li>
        
      
    
    <li>Aligning and error analysis</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/clu-ling/clu-phontools/blob/main/docs/examples/asu-use-case.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link"></a></h1>
<p>Let's take a look at how to use <code>ReAline</code> to <em>align phonological sequences</em> and then <em>analyze errors</em> in the style of <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6808349/pdf/JSLHR-62-3359.pdf#page=4">Jiao et al. (2019)</a></p>
<p>For this example, we'll need the following imports:</p>
<pre><code class="language-python">from clu.phontools.lang.en import EnglishUtils
from clu.phontools.struct import *
from clu.phontools.pronouncing import ConverterUtils
from clu.phontools.alignment.realine import *
from clu.phontools.alignment.lbe import *
</code></pre>
<p>We'll be aligning a <strong>target</strong> phrase with a <strong>transcript</strong> phrase.</p>
<p>In our example, our <strong>target</strong> phrase will be ...</p>
<blockquote>
<p>balance clamp and bottle</p>
</blockquote>
<p>... and our <strong>transcribed</strong> phrase will be ...</p>
<blockquote>
<p>bell is glad a bottle</p>
</blockquote>
<h1 id="phrases-and-syllables">Phrases and syllables<a class="headerlink" href="#phrases-and-syllables" title="Permanent link"></a></h1>
<p><code>clu-phontools</code> makes it easy to find all possible attested pronunciations for a phrase via a pronouncing dictionary.  In the case of English, we can use the <strong>CMU pronouncing dictionary</strong>:</p>
<pre><code class="language-python"># prompt/target is &quot;balance clamp and bottle&quot;
# get all pronunciations for the phrase
# return a sequence of `clu.phontools.struct.Phrase`
target_phrases = EnglishUtils.all_possible_phrases_for([&quot;balance&quot;, &quot;clamp&quot;, &quot;and&quot;, &quot;bottle&quot;])
</code></pre>
<p>How many pronunciations did we find?  In this case, there should be 2:</p>
<pre><code class="language-python">assert len(target_phrases) == 2
</code></pre>
<p>Let's examine the <em>stress patterns</em>. Perhaps we only care about the distinction between <strong>strong</strong> (S) and <strong>weak</strong> (W) syllables:</p>
<pre><code class="language-python"># let's examine the stress patterns...
for phrase in target_phrases:
  print(phrase.coarse_stress)
</code></pre>
<p>Perhaps we have a particular stress pattern we're interested in examining.  For this example, we'll pretend we're interested in finding phrases with the stres pattern <strong>SW S W SW</strong>:</p>
<pre><code class="language-python"># our stress pattern of interest
pattern = &quot;SW S W SW&quot;

# find the first Phrase that matches our pattern.
# we'll use the first entry (stress pattern = [&quot;SW&quot;, &quot;S&quot;, &quot;W&quot;, &quot;SW&quot;])
# as our target.
match_stress = lambda phrase: phrase.match_coarse_stress_pattern(pattern)
target: Phrase = next(filter(match_stress, target_phrases))
</code></pre>
<p>We'll apply the same steps to find transcript phrases:</p>
<pre><code class="language-python"># transcript says &quot;bell is glad a bottle&quot;
# get all pronunciations for the phrase
transcript_phrases = EnglishUtils.all_possible_phrases_for(
  [&quot;bell&quot;, &quot;is&quot;, &quot;glad&quot;, &quot;a&quot;, &quot;bottle&quot;]
)

# in this case, there should be 4:
assert len(transcript_phrases) == 4
</code></pre>
<p>Before we searched for a particular syllable-stress pattern.  Let's ignore stress for a moment and simply look for a pattern of syllables.  Imagine we're interested in phrases composed of 4 monosyllabic words followed by a disyllabic word.  We can represent this pattern using <strong>X X X X XX</strong> where <strong>X</strong> denotes a syllable and whitespace represents a lexical boundary:</p>
<pre><code class="language-python"># all of these phrases have 6 syllables with the structure &quot;X X X X XX&quot;.
# If you're unfamiliar with regular expressions, keep in mind that ...
#   ^ in the pattern below means &quot;starts with&quot;
#   $ in the pattern below denotes the &quot;end of sequence&quot;
all(phrase.match_masked_syllables(pattern=&quot;^X X X X XX$&quot;, mask=&quot;X&quot;) for phrase in transcript_phrases)

# for our comparisons, let's use the first one:
transcript: Phrase = transcript_phrases[0]
</code></pre>
<h1 id="alignment">Alignment<a class="headerlink" href="#alignment" title="Permanent link"></a></h1>
<p>Now that we have both a <strong>target</strong> and <strong>transcript</strong>, let's use <strong>ReAline</strong> to align the two phonological sequences:</p>
<pre><code class="language-python"># let's calculate lexical boundary errors for the first one:
aligner = ReAline()
</code></pre>
<p>By default, ReAline expects to align IPA, so we'll first want to convert our ARPABet-based representations to IPA:</p>
<pre><code class="language-python">target_phones = [ConverterUtils.arpabet_to_ipa(phone) for phone in target.phones]
transcript_phones = [ConverterUtils.arpabet_to_ipa(phone) for phone in transcript.phones]
alignment = aligner.align(target_phones, transcript_phones)
</code></pre>
<p><code>alignment</code> should have the following value in this case (NOTE: newlines added for better legibility):</p>
<pre><code class="language-python">[
  ('b', 'b'), ('æ', 'ɛ'), ('l', 'l'), ('ʌ', 'i'), ('n', '-'), ('s', 'z'),
  ('k', 'g'), ('l', 'l'), ('æ', 'æ'), ('m', '-'), ('p', '-'),
  ('ʌ', '-'), ('n', '-'), ('d', 'd'),
  ('-', 'ʌ'), ('b', 'b'), ('ɒ', 'ɒ'), ('t', 't'), ('ʌ', 'ʌ'), ('l', 'l')
]
</code></pre>
<h1 id="error-analysis">Error analysis<a class="headerlink" href="#error-analysis" title="Permanent link"></a></h1>
<p>Now that we have an automatically aligned sequence, let's analyze the phonological and lexical boundary errors in our <strong>transcript</strong>.</p>
<h2 id="phoneme-errors">Phoneme errors<a class="headerlink" href="#phoneme-errors" title="Permanent link"></a></h2>
<p>First, let's calculate phoneme errors:</p>
<pre><code class="language-python">#
phoneme_errors = aligner.phoneme_errors(alignment)
</code></pre>
<h2 id="lexical-boundary-errors">Lexical boundary errors<a class="headerlink" href="#lexical-boundary-errors" title="Permanent link"></a></h2>
<p>Next, let's calculate lexical boundary errors (LBEs):</p>
<pre><code class="language-python">target_stress = target.coarse_stress
# should produce ['SW', 'S', 'W', 'SW']

transcript_masked_stress = transcript.mask_syllables(mask=&quot;X&quot;)
# should produce ['X', 'X', 'X', 'X', 'XX']

lbe_errors = calculate_lbes_from_stress(target_stress, transcript_masked_stress)
# should produce [LexicalBoundaryError(error_type=LexicalBoundaryErrorType.INSERTION_WEAK, target_index=0, transcript_index=0)]
</code></pre>
<h1 id="wrapping-up">Wrapping up<a class="headerlink" href="#wrapping-up" title="Permanent link"></a></h1>
<p>A script containing this same example can be found at <a href="https://github.com/clu-ling/clu-phontools/blob/main/examples/asu-use-case.py"><code>examples/asu-use-case.py</code></a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../api/clu/phontools/" class="btn btn-neutral float-right" title="clu.phontools">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../rest-api/" class="btn btn-neutral" title="REST API"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2021 <a href="https://parsertongue.org/about">Gus Hahn-Powell</a>.</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/clu-ling/clu-phontools/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../rest-api/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../api/clu/phontools/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
